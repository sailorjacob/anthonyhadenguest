// Gallery data
const galleryData = {
    'smile-wars': [
        {
            id: 1,
            title: 'Smile Wars #1',
            description: 'Social Commentary',
            src: 'https://drive.google.com/uc?export=view&id=15qBDc3LPXkE1W5mcnXw9BcKfibgZ-cWu',
            series: 'smile-wars'
        },
        {
            id: 2,
            title: 'Smile Wars #2',
            description: 'Cultural Observation',
            src: 'https://drive.google.com/uc?export=view&id=1HdzxIvntWTRYEetW3x-oLvSXFuoijq1b',
            series: 'smile-wars'
        },
        {
            id: 3,
            title: 'Smile Wars #3',
            description: 'Social Dynamics',
            src: 'https://drive.google.com/uc?export=view&id=1K8cpyUtTpTLxwyYGhL1E5JW8jxcXS1bV',
            series: 'smile-wars'
        },
        {
            id: 4,
            title: 'Smile Wars #4',
            description: 'Contemporary Critique',
            src: 'https://drive.google.com/uc?export=view&id=1Lt-eHT25vxcP8L_Lw_oaFgCK5yQ6qT86',
            series: 'smile-wars'
        },
        {
            id: 5,
            title: 'Smile Wars #5',
            description: 'Visual Commentary',
            src: 'https://drive.google.com/uc?export=view&id=1M9C7al8RI3b0YGHgbSKuFWMekND0kbHZ',
            series: 'smile-wars'
        },
        {
            id: 6,
            title: 'Smile Wars #6',
            description: 'Satirical Insight',
            src: 'https://drive.google.com/uc?export=view&id=1hVZe2oaaoMe5_RdLtzsKDBVQeJSkk2_-',
            series: 'smile-wars'
        },
        {
            id: 7,
            title: 'Smile Wars #7',
            description: 'Social Observation',
            src: 'https://drive.google.com/uc?export=view&id=1upzI1GpCAOltJROvnje_7j0h0M8hbCUe',
            series: 'smile-wars'
        }
    ],
    'things-next': [
        {
            id: 8,
            title: 'Things Next #1',
            description: 'Future Dynamics',
            src: 'https://drive.google.com/uc?export=view&id=1A7QXz0vClnkrnofbuxVRtDqeDls8rcKc',
            series: 'things-next'
        },
        {
            id: 9,
            title: 'Things Next #2',
            description: 'Cultural Evolution',
            src: 'https://drive.google.com/uc?export=view&id=1BYku9SYIAPNbaBWPuVzTDhdR_0C4VJwp',
            series: 'things-next'
        },
        {
            id: 10,
            title: 'Things Next #3',
            description: 'Social Prediction',
            src: 'https://drive.google.com/uc?export=view&id=1E9M_YCUHsW1-SurimINJnMrC1ZahozPn',
            series: 'things-next'
        },
        {
            id: 11,
            title: 'Things Next #4',
            description: 'Future Commentary',
            src: 'https://drive.google.com/uc?export=view&id=1F7H7caYwGZkp8EE4DK-aO9diwIvg0Oii',
            series: 'things-next'
        },
        {
            id: 12,
            title: 'Things Next #5',
            description: 'Emerging Trends',
            src: 'https://drive.google.com/uc?export=view&id=1HkSM-aVwpBUz4KVRDX__XSNIBMHQe7xI',
            series: 'things-next'
        },
        {
            id: 13,
            title: 'Things Next #6',
            description: 'Progressive Insight',
            src: 'https://drive.google.com/uc?export=view&id=1RMcuXx5w-I_5WqgdI8Y3urA531XB8Sn-',
            series: 'things-next'
        },
        {
            id: 14,
            title: 'Things Next #7',
            description: 'Tomorrow\'s Satire',
            src: 'https://drive.google.com/uc?export=view&id=1UoxtKGQKvk5bFF4qyYiROtwhSRh7iFh1',
            series: 'things-next'
        },
        {
            id: 15,
            title: 'Things Next #8',
            description: 'Future Vision',
            src: 'https://drive.google.com/uc?export=view&id=1ViPloe6k_qM8WgbNe2_9wFmXwXmONh8',
            series: 'things-next'
        },
        {
            id: 16,
            title: 'Things Next #9',
            description: 'Cultural Forecast',
            src: 'https://drive.google.com/uc?export=view&id=1WwC53TAn82qB6Rv-acRJBfT_D1aTB25r',
            series: 'things-next'
        },
        {
            id: 17,
            title: 'Things Next #10',
            description: 'Next Generation',
            src: 'https://drive.google.com/uc?export=view&id=1dh1gacfbzJIB-CfYcJSth3sQ6MtIlfj5',
            series: 'things-next'
        },
        {
            id: 18,
            title: 'Things Next #11',
            description: 'Forward Thinking',
            src: 'https://drive.google.com/uc?export=view&id=1fH3GrsjEWQf47cH79ND4CDniMVzTa-Wr',
            series: 'things-next'
        },
        {
            id: 19,
            title: 'Things Next #12',
            description: 'Future Perspective',
            src: 'https://drive.google.com/uc?export=view&id=1i7uU-qR3ciIqABIVxhK-sm9DLBMXxjmP',
            series: 'things-next'
        },
        {
            id: 20,
            title: 'Things Next #13',
            description: 'Anticipatory Art',
            src: 'https://drive.google.com/uc?export=view&id=1nReW3MK6B7M2ZuKcebvNSz3JlUu_Kl1z',
            series: 'things-next'
        },
        {
            id: 21,
            title: 'Things Next #14',
            description: 'Future Narrative',
            src: 'https://drive.google.com/uc?export=view&id=1o1kWyHFI_c7FmqoaNqM5p5HUiR4TmIoH',
            series: 'things-next'
        },
        {
            id: 22,
            title: 'Things Next #15',
            description: 'Tomorrow\'s Truth',
            src: 'https://drive.google.com/uc?export=view&id=1tMMHlBCn6ZX0DvkPL2dXvaIRQO4j1ikM',
            series: 'things-next'
        }
    ]
};

// Flatten all gallery data for easier access
const allImages = [...galleryData['smile-wars'], ...galleryData['things-next']];

// DOM Elements
const lightbox = document.getElementById('lightbox');
const lightboxImage = document.getElementById('lightbox-image');
const lightboxTitle = document.getElementById('lightbox-title');
const lightboxDescription = document.getElementById('lightbox-description');
const lightboxClose = document.querySelector('.lightbox-close');
const prevBtn = document.querySelector('.prev-btn');
const nextBtn = document.querySelector('.next-btn');
const filterBtns = document.querySelectorAll('.filter-btn');
const cartoonItems = document.querySelectorAll('.cartoon-item');
const navToggle = document.querySelector('.nav-toggle');
const navLinks = document.querySelector('.nav-links');

// State
let currentImageIndex = 0;
let currentFilter = 'all';
let filteredImages = allImages;

// Initialize
document.addEventListener('DOMContentLoaded', function() {
    initializeGallery();
    setupEventListeners();
    setupImageLoading();
    setupScrollAnimations();
});

// Initialize gallery
function initializeGallery() {
    // Set up initial filter
    filterGallery('all');
    
    // Add click handlers to cartoon items
    cartoonItems.forEach(item => {
        item.addEventListener('click', () => {
            const itemId = parseInt(item.getAttribute('data-id'));
            openLightbox(itemId);
        });
    });
}

// Setup event listeners
function setupEventListeners() {
    // Filter buttons
    filterBtns.forEach(btn => {
        btn.addEventListener('click', () => {
            const filter = btn.getAttribute('data-filter');
            setActiveFilter(btn);
            filterGallery(filter);
        });
    });

    // Lightbox controls
    lightboxClose.addEventListener('click', closeLightbox);
    prevBtn.addEventListener('click', () => navigateLightbox(-1));
    nextBtn.addEventListener('click', () => navigateLightbox(1));

    // Close lightbox on backdrop click
    lightbox.addEventListener('click', (e) => {
        if (e.target === lightbox || e.target.classList.contains('lightbox-backdrop')) {
            closeLightbox();
        }
    });

    // Keyboard navigation
    document.addEventListener('keydown', handleKeyboard);

    // Mobile navigation
    navToggle.addEventListener('click', toggleMobileNav);

    // Close mobile nav on link click
    document.querySelectorAll('.nav-link').forEach(link => {
        link.addEventListener('click', () => {
            navLinks.classList.remove('active');
            navToggle.classList.remove('active');
        });
    });

    // Smooth scroll for navigation links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                const headerHeight = document.querySelector('.navbar').offsetHeight;
                const targetPosition = target.offsetTop - headerHeight - 20;
                
                window.scrollTo({
                    top: targetPosition,
                    behavior: 'smooth'
                });
            }
        });
    });
}

// Set active filter button
function setActiveFilter(activeBtn) {
    filterBtns.forEach(btn => btn.classList.remove('active'));
    activeBtn.classList.add('active');
}

// Filter gallery
function filterGallery(filter) {
    currentFilter = filter;
    
    if (filter === 'all') {
        filteredImages = allImages;
        cartoonItems.forEach(item => {
            item.classList.remove('hidden');
            item.classList.add('visible');
        });
    } else {
        filteredImages = allImages.filter(img => img.series === filter);
        
        cartoonItems.forEach(item => {
            const itemSeries = item.closest('.masonry-grid').getAttribute('data-series');
            
            if (filter === itemSeries) {
                item.classList.remove('hidden');
                item.classList.add('visible');
            } else {
                item.classList.add('hidden');
                item.classList.remove('visible');
            }
        });
    }
}

// Open lightbox
function openLightbox(imageId) {
    const imageData = allImages.find(img => img.id === imageId);
    if (!imageData) return;

    currentImageIndex = filteredImages.findIndex(img => img.id === imageId);
    
    lightboxImage.src = imageData.src;
    lightboxTitle.textContent = imageData.title;
    lightboxDescription.textContent = imageData.description;
    
    lightbox.classList.add('active');
    document.body.style.overflow = 'hidden';
    
    // Add loading state
    lightboxImage.style.opacity = '0';
    lightboxImage.onload = () => {
        lightboxImage.style.transition = 'opacity 0.3s ease';
        lightboxImage.style.opacity = '1';
    };
}

// Close lightbox
function closeLightbox() {
    lightbox.classList.remove('active');
    document.body.style.overflow = 'auto';
}

// Navigate lightbox
function navigateLightbox(direction) {
    if (filteredImages.length === 0) return;
    
    currentImageIndex += direction;
    
    if (currentImageIndex >= filteredImages.length) {
        currentImageIndex = 0;
    } else if (currentImageIndex < 0) {
        currentImageIndex = filteredImages.length - 1;
    }
    
    const imageData = filteredImages[currentImageIndex];
    
    // Fade out
    lightboxImage.style.opacity = '0';
    
    setTimeout(() => {
        lightboxImage.src = imageData.src;
        lightboxTitle.textContent = imageData.title;
        lightboxDescription.textContent = imageData.description;
        
        lightboxImage.onload = () => {
            lightboxImage.style.opacity = '1';
        };
    }, 150);
}

// Handle keyboard navigation
function handleKeyboard(e) {
    if (!lightbox.classList.contains('active')) return;
    
    switch(e.key) {
        case 'Escape':
            closeLightbox();
            break;
        case 'ArrowLeft':
            navigateLightbox(-1);
            break;
        case 'ArrowRight':
            navigateLightbox(1);
            break;
    }
}

// Toggle mobile navigation
function toggleMobileNav() {
    navLinks.classList.toggle('active');
    navToggle.classList.toggle('active');
}

// Setup image loading with fade-in effect
function setupImageLoading() {
    const images = document.querySelectorAll('.cartoon-item img');
    
    images.forEach(img => {
        if (img.complete) {
            img.classList.add('loaded');
        } else {
            img.addEventListener('load', () => {
                img.classList.add('loaded');
            });
        }
    });
}

// Setup scroll animations
function setupScrollAnimations() {
    const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
    };

    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('visible');
            }
        });
    }, observerOptions);

    // Observe elements for scroll animations
    document.querySelectorAll('.section-header, .cartoon-item').forEach(el => {
        el.classList.add('fade-in');
        observer.observe(el);
    });
}

// Navbar scroll effect
window.addEventListener('scroll', () => {
    const navbar = document.querySelector('.navbar');
    if (window.scrollY > 100) {
        navbar.style.background = 'rgba(255, 255, 255, 0.98)';
        navbar.style.boxShadow = '0 4px 20px rgba(0, 0, 0, 0.1)';
    } else {
        navbar.style.background = 'rgba(255, 255, 255, 0.95)';
        navbar.style.boxShadow = 'none';
    }
});

// Preload images for better performance
function preloadImages() {
    allImages.forEach(item => {
        const img = new Image();
        img.src = item.src;
    });
}

// Initialize preloading
setTimeout(preloadImages, 1000);

// Touch/swipe support for mobile lightbox navigation
let touchStartX = 0;
let touchEndX = 0;

lightbox.addEventListener('touchstart', (e) => {
    touchStartX = e.changedTouches[0].screenX;
});

lightbox.addEventListener('touchend', (e) => {
    touchEndX = e.changedTouches[0].screenX;
    handleSwipe();
});

function handleSwipe() {
    const swipeThreshold = 50;
    const diff = touchStartX - touchEndX;
    
    if (Math.abs(diff) > swipeThreshold) {
        if (diff > 0) {
            // Swipe left - next image
            navigateLightbox(1);
        } else {
            // Swipe right - previous image
            navigateLightbox(-1);
        }
    }
}

// Lazy loading for better performance
function setupLazyLoading() {
    const imageObserver = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                const img = entry.target;
                img.src = img.dataset.src || img.src;
                img.classList.remove('lazy');
                imageObserver.unobserve(img);
            }
        });
    });

    document.querySelectorAll('img[loading="lazy"]').forEach(img => {
        imageObserver.observe(img);
    });
}

// Initialize lazy loading
setupLazyLoading();

// Error handling for images
document.querySelectorAll('.cartoon-item img').forEach(img => {
    img.addEventListener('error', function() {
        this.style.display = 'none';
        const parent = this.closest('.cartoon-item');
        if (parent) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'image-error';
            errorDiv.innerHTML = '<p>Image temporarily unavailable</p>';
            errorDiv.style.cssText = `
                display: flex;
                align-items: center;
                justify-content: center;
                height: 200px;
                background: #f8f9fa;
                color: #666;
                font-style: italic;
            `;
            parent.appendChild(errorDiv);
        }
    });
});

// Analytics tracking (placeholder)
function trackGalleryInteraction(action, item) {
    // Add your analytics tracking here
    console.log(`Gallery interaction: ${action}`, item);
}

// Track lightbox opens
const originalOpenLightbox = openLightbox;
openLightbox = function(imageId) {
    const imageData = allImages.find(img => img.id === imageId);
    trackGalleryInteraction('lightbox_open', imageData);
    return originalOpenLightbox.call(this, imageId);
};

// Track filter usage
const originalFilterGallery = filterGallery;
filterGallery = function(filter) {
    trackGalleryInteraction('filter_change', { filter });
    return originalFilterGallery.call(this, filter);
}; 